!function(C){C.fn.magnify=function(W){W=C.extend({src:"",speed:100,timeout:-1,touchBottomOffset:0,finalWidth:null,finalHeight:null,magnifiedWidth:null,magnifiedHeight:null,limitBounds:!1,mobileCloseEvent:"touchstart",afterLoad:function(){}},W);var t=this,x=C("html"),e=0,M=function(){clearTimeout(e),e=setTimeout(function(){t.destroy(),t.magnify(W)},100)};return this.destroy=function(){return this.each(function(){var t=C(this),e=t.prev("div.magnify-lens"),i=t.data("originalStyle");t.parent("div.magnify").length&&e.length&&(i?t.attr("style",i):t.removeAttr("style"),t.unwrap(),e.remove())}),C(window).off("resize",M),t},C(window).resize(M),this.each(function(){var t,o=C(this),i=o.closest("a"),n={};for(t in W)n[t]=o.attr("data-magnify-"+t.toLowerCase());var a,s,l,r,f,d,c,u,h,g,m,p,v,y,b,w,N,B,k,E,H=n.src||W.src||i.attr("href")||"";H&&(g=h=0,N=function(){var t=a.offset();return w={top:o.offset().top-t.top+parseInt(o.css("border-top-width"))+parseInt(o.css("padding-top")),left:o.offset().left-t.left+parseInt(o.css("border-left-width"))+parseInt(o.css("padding-left"))},t.top+=w.top,t.left+=w.left,t},B=function(){s.is(":visible")&&s.fadeOut(W.speed,function(){x.removeClass("magnifying").trigger("magnifyend")})},k=function(t){var e,i,n,a;r?(t?(t.preventDefault(),m=t.pageX||t.originalEvent.touches[0].pageX,p=t.pageY||t.originalEvent.touches[0].pageY,o.data("lastPos",{x:m,y:p})):(m=o.data("lastPos").x,p=o.data("lastPos").y),v=m-b.left,y=p-b.top-W.touchBottomOffset,s.is(":animated")||(h<v&&v<l-h&&g<y&&y<r-g?s.is(":hidden")&&(x.addClass("magnifying").trigger("magnifystart"),s.fadeIn(W.speed)):B()),s.is(":visible")&&(t="",f&&d&&(e=-Math.round(v/l*f-c/2),i=-Math.round(y/r*d-u/2),W.limitBounds&&(n=-Math.round((l-h)/l*f-c/2),a=-Math.round((r-g)/r*d-u/2),0<e?e=0:e<n&&(e=n),0<i?i=0:i<a&&(i=a)),t=e+"px "+i+"px"),s.css({top:Math.round(y-u/2)+w.top+"px",left:Math.round(v-c/2)+w.left+"px","background-position":t}))):M()},isNaN(+n.speed)||(W.speed=+n.speed),isNaN(+n.timeout)||(W.timeout=+n.timeout),isNaN(+n.finalWidth)||(W.finalWidth=+n.finalWidth),isNaN(+n.finalHeight)||(W.finalHeight=+n.finalHeight),isNaN(+n.magnifiedWidth)||(W.magnifiedWidth=+n.magnifiedWidth),isNaN(+n.magnifiedHeight)||(W.magnifiedHeight=+n.magnifiedHeight),"true"===n.limitBounds&&(W.limitBounds=!0),"function"==typeof window[n.afterLoad]&&(W.afterLoad=window[n.afterLoad]),/\b(Android|BlackBerry|IEMobile|iPad|iPhone|Mobile|Opera Mini)\b/.test(navigator.userAgent)?isNaN(+n.touchBottomOffset)||(W.touchBottomOffset=+n.touchBottomOffset):W.touchBottomOffset=0,o.data("originalStyle",o.attr("style")),E=new Image,C(E).on({load:function(){o.css("display","block"),o.parent(".magnify").length||o.wrap('<div class="magnify"></div>'),a=o.parent(".magnify"),o.prev(".magnify-lens").length?a.children(".magnify-lens").css("background-image","url('"+H+"')"):o.before('<div class="magnify-lens loading" style="background:url(\''+H+"') 0 0 no-repeat\"></div>"),(s=a.children(".magnify-lens")).removeClass("loading"),l=W.finalWidth||o.width(),r=W.finalHeight||o.height(),f=W.magnifiedWidth||E.width,d=W.magnifiedHeight||E.height,c=s.width(),u=s.height(),b=N(),W.limitBounds&&(h=c/2/(f/l),g=u/2/(d/r)),f===E.width&&d===E.height||s.css("background-size",f+"px "+d+"px"),o.data("zoomSize",{width:f,height:d}),a.data("mobileCloseEvent",n.mobileCloseEvent||W.mobileCloseEvent),E=null,W.afterLoad(),s.is(":visible")&&k(),a.off().on({"mousemove touchmove":k,mouseenter:function(){b=N()},mouseleave:B}),0<=W.timeout&&a.on("touchend",function(){setTimeout(B,W.timeout)}),C("body").not(a).on("touchstart",B);var e,t=o.attr("usemap");t&&(e=C("map[name="+t.slice(1)+"]"),o.after(e),a.click(function(t){(t.clientX||t.clientY)&&(s.hide(),"AREA"===(t=document.elementFromPoint(t.clientX||t.originalEvent.touches[0].clientX,t.clientY||t.originalEvent.touches[0].clientY)).nodeName?t.click():C("area",e).each(function(){var t=C(this).attr("coords").split(",");if(v>=t[0]&&v<=t[2]&&y>=t[1]&&y<=t[3])return this.click(),!1}))})),i.length&&(i.css("display","inline-block"),!i.attr("href")||n.src||W.src||i.click(function(t){t.preventDefault()}))},error:function(){E=null}}),E.src=H)})}}(jQuery);